{% extends 'admin_base.html' %}
{% block admin_content %}

<h2>Gestión de Inventario</h2>
<a href="{{ url_for('agregar_producto') }}" class="cta-button" style="margin-bottom:1.5rem; display:inline-block;">Agregar Producto</a>

<div style="margin-bottom:1.5rem;">
	<input type="text" id="buscador-inventario" placeholder="Buscar producto por nombre, descripción..." style="width:100%; max-width:340px; padding:0.6rem 1rem; border-radius:7px; border:1px solid #bbb; font-size:1.08rem;">
</div>

<h3 style="margin-top:2rem; color:#0d6efd;">Productos Solares</h3>
<table class="usuarios-table tabla-inventario" style="width:100%; border-collapse:collapse; margin:1.5rem 0;">
	<thead>
		<tr style="background:#f2f2f2;">
			<th>ID</th>
			<th>Nombre</th>
			<th>Descripción</th>
			<th>Precio</th>
			<th>Cantidad</th>
			<th>Disponible</th>
			<th>Foto</th>
			<th>Acciones</th>
		</tr>
	</thead>
	<tbody>
		{% for p in productos_solar %}
		<tr>
			<td>{{ p.id }}</td>
			<td>{{ p.nombre }}</td>
			<td>{{ p.descripcion }}</td>
			<td>${{ '%.2f'|format(p.precio) }}</td>
			<td>{{ p.cantidad }}</td>
			<td>{% if p.disponible == 'si' %}<span style="color:green; font-weight:600;">Sí</span>{% else %}<span style="color:#b91c1c; font-weight:600;">No</span>{% endif %}</td>
			<td>
				{% if p.foto %}
				<img src="{{ url_for('static', filename='img/productos/' ~ p.foto) }}" alt="Foto producto" style="max-width:60px; max-height:60px; border-radius:8px;">
				{% else %}
				<span class="text-muted">Sin foto</span>
				{% endif %}
			</td>
			<td>
				<a href="{{ url_for('editar_producto', producto_id=p.id) }}" class="cta-button" style="background:#ffc107; color:#222; padding:0.3rem 0.7rem; font-size:0.95rem;">Editar</a>
				<form action="{{ url_for('eliminar_producto', producto_id=p.id) }}" method="post" style="display:inline; margin-left:0.3rem;" onsubmit="return confirm('¿Seguro que deseas eliminar este producto?');">
					<button type="submit" class="cta-button" style="background:#dc3545; color:#fff; padding:0.3rem 0.7rem; font-size:0.95rem;">Eliminar</button>
				</form>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>

<h3 style="margin-top:2rem; color:#0d6efd;">Productos Eólicos</h3>
<table class="usuarios-table tabla-inventario" style="width:100%; border-collapse:collapse; margin:1.5rem 0;">
	<thead>
		<tr style="background:#f2f2f2;">
			<th>ID</th>
			<th>Nombre</th>
			<th>Descripción</th>
			<th>Precio</th>
			<th>Cantidad</th>
			<th>Disponible</th>
			<th>Foto</th>
			<th>Acciones</th>
		</tr>
	</thead>
	<tbody>
		{% for p in productos_eolico %}
		<tr>
			<td>{{ p.id }}</td>
			<td>{{ p.nombre }}</td>
			<td>{{ p.descripcion }}</td>
			<td>${{ '%.2f'|format(p.precio) }}</td>
			<td>{{ p.cantidad }}</td>
			<td>{% if p.disponible == 'si' %}<span style="color:green; font-weight:600;">Sí</span>{% else %}<span style="color:#b91c1c; font-weight:600;">No</span>{% endif %}</td>
			<td>
				{% if p.foto %}
				<img src="{{ url_for('static', filename='img/productos/' ~ p.foto) }}" alt="Foto producto" style="max-width:60px; max-height:60px; border-radius:8px;">
				{% else %}
				<span class="text-muted">Sin foto</span>
				{% endif %}
			</td>
			<td>
				<a href="{{ url_for('editar_producto', producto_id=p.id) }}" class="cta-button" style="background:#ffc107; color:#222; padding:0.3rem 0.7rem; font-size:0.95rem;">Editar</a>
				<form action="{{ url_for('eliminar_producto', producto_id=p.id) }}" method="post" style="display:inline; margin-left:0.3rem;" onsubmit="return confirm('¿Seguro que deseas eliminar este producto?');">
					<button type="submit" class="cta-button" style="background:#dc3545; color:#fff; padding:0.3rem 0.7rem; font-size:0.95rem;">Eliminar</button>
				</form>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>

<h3 style="margin-top:2rem; color:#0d6efd;">Ingeniería y Proyectos</h3>
<table class="usuarios-table tabla-inventario" style="width:100%; border-collapse:collapse; margin:1.5rem 0;">
	<thead>
		<tr style="background:#f2f2f2;">
			<th>ID</th>
			<th>Nombre</th>
			<th>Descripción</th>
			<th>Precio</th>
			<th>Cantidad</th>
			<th>Disponible</th>
			<th>Foto</th>
			<th>Acciones</th>
		</tr>
	</thead>
	<tbody>
		{% for p in productos_ingenieria %}
		<tr>
			<td>{{ p.id }}</td>
			<td>{{ p.nombre }}</td>
			<td>{{ p.descripcion }}</td>
			<td>${{ '%.2f'|format(p.precio) }}</td>
			<td>{{ p.cantidad }}</td>
			<td>{% if p.disponible == 'si' %}<span style="color:green; font-weight:600;">Sí</span>{% else %}<span style="color:#b91c1c; font-weight:600;">No</span>{% endif %}</td>
			<td>
				{% if p.foto %}
				<img src="{{ url_for('static', filename='img/productos/' ~ p.foto) }}" alt="Foto producto" style="max-width:60px; max-height:60px; border-radius:8px;">
				{% else %}
				<span class="text-muted">Sin foto</span>
				{% endif %}
			</td>
			<td>
				<a href="{{ url_for('editar_producto', producto_id=p.id) }}" class="cta-button" style="background:#ffc107; color:#222; padding:0.3rem 0.7rem; font-size:0.95rem;">Editar</a>
				<form action="{{ url_for('eliminar_producto', producto_id=p.id) }}" method="post" style="display:inline; margin-left:0.3rem;" onsubmit="return confirm('¿Seguro que deseas eliminar este producto?');">
					<button type="submit" class="cta-button" style="background:#dc3545; color:#fff; padding:0.3rem 0.7rem; font-size:0.95rem;">Eliminar</button>
				</form>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
<script>
// Buscador de productos en inventario (afecta todas las tablas de productos)
document.addEventListener('DOMContentLoaded', function() {
	const input = document.getElementById('buscador-inventario');
	const tablas = document.querySelectorAll('.tabla-inventario');
	if(input && tablas.length) {
		input.addEventListener('keyup', function() {
			const filtro = input.value.toLowerCase();
			tablas.forEach(function(tabla) {
				const filas = tabla.querySelectorAll('tbody tr');
				filas.forEach(function(tr) {
					const texto = tr.textContent.toLowerCase();
					tr.style.display = texto.includes(filtro) ? '' : 'none';
				});
			});
		});
	}
});
</script>
{% endblock %}
